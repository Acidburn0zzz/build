{% extends "layout.html" %}

{% block header -%}
<script>
  function autoLink(className) {
    var comments = document.querySelectorAll(className);
    for(var i = 0; i < comments.length; i++) {
      comments[i].innerHTML = comments[i].innerHTML.replace(/http:\/\/[^ \t\n<]*/g, '<a href="$&">$&</a>');
    }
  }

  window.onload = function() {
    autoLink('.DevComment');
  }
</script>

<div class="Announcement">

<iframe width="100%" height="44" frameborder="0" scrolling="no" src="http://chromium-status.appspot.com/current"></iframe>

<center style="padding: 0 7px">
  <table width="100%" valign="top" bgcolor="#efefef" style="-webkit-border-bottom-left-radius: 24px; -webkit-border-bottom-right-radius: 24px; -moz-border-bottom-right-radius: 24px; -moz-border-bottom-right-radius: 24px;   box-shadow: 2px 2px 6px rgba(0,0,0,0.6); -moz-box-shadow: 2px 2px 6px rgba(0,0,0,0.6); -webkit-box-shadow: 2px 2px 6px rgba(0,0,0,0.6);">
    <tr>
      <td width="23%">
        <table valign="top" width="100%">
          <tr>
            <td style="text-align: right;">
              <b>Builds:</b>
            </td>
            <td>
              <a href="http://commondatastorage.googleapis.com/chromium-browser-continuous/index.html">continuous</a> |
              <a href="http://chromium-browser-symbols.commondatastorage.googleapis.com/index.html">symbols</a> |
              <a href="http://chromium-status.appspot.com">status</a>
            </td>
          </tr>
          <tr>
            <td style="text-align: right;">
              <b>Dashboards:</b>
            </td>
            <td>
              <a href="http://build.chromium.org/f/chromium/perf/dashboard/overview.html">perf</a> |
              <a href="http://build.chromium.org/f/chromium/perf/dashboard/memory.html">memory</a> |
              <a href="http://build.chromium.org/f/chromium/perf/dashboard/sizes.html">sizes</a> |
              <a href="http://build.chromium.org/f/chromium/coverage/">coverage</a> |
              <a href="http://build.chromium.org/f/chromium/flakiness/">flakiness</a> |
              <a href="http://build.chromium.org/p/chromium/stats">stats</a>
            </td>
          </tr>
          <tr>
            <td style="text-align: right;">
              <b>Chromium:</b>
            </td>
            <td>
              <a href="http://src.chromium.org/viewvc/chrome">sources</a> |
              <a href="http://codereview.chromium.org/">reviews</a> |
              <a href="http://code.google.com/p/chromium/issues/list?can=2&q=&sort=pri+mstone&colspec=ID%20Stars%20Pri%20Area%20Type%20Status%20Summary%20Modified%20Owner%20Mstone">bugs</a> |
              <a href="http://dev.chromium.org/Home">dev</a> |
              <a href="http://www.google.com/support/chrome/">support</a>
            </td>
          </tr>
          <tr>
            <td style="text-align: right;">
               <b>Sheriffs:</b>
            </td>
            <td>
              <script src='./sheriff.js'></script>, <script src='./sheriff_webkit.js'></script>(WebKit), <script src='./sheriff_memory.js'></script>(Memory),
              <a href="https://www.google.com/calendar/render?cid=google.com_iqfka4i9asiva67vlqqf1es094%40group.calendar.google.com">trooper schedule</a>
            </td>
          </tr>
          <tr>
            <td style="text-align: right;">
               <b>Navigate:</b>
            </td>
            <td colspan="2">
              <a href="http://dev.chromium.org/developers/testing/chromium-build-infrastructure/tour-of-the-chromium-buildbot">about</a> |
              <a href="./waterfall/help">customize</a> |
              <a href="../tryserver.chromium">try</a> |
              <a href="../chromium.fyi/waterfall">experimental</a> |
              <a href="../chromium/waterfall">waterfall</a> |
              <a href="../chromium/waterfall?show_events=true&failures_only=true">failures</a> |
              <a href="../chromium/console">console</a> |
              <a href="../chromium.memory/console">memory</a> |
              <a href="../chromiumos/waterfall">chromiumos</a>
            </td>
          </tr>
        </table>
      </td>
      <td width="1" bgcolor="#CCCCCC">
      </td>
      <td width="4%" style='padding: 0px 2px 0px 2px;'>
        <div style='height: 120px; width: 120px'>
          <table>
            <tr>
              <td class='Builder' style='border-top-left-radius: 15px; border-top-right-radius: 15px;'>
                <a href='../chromium/waterfall?builder=Win%20Reliability'>Reliability</a>
              </td>
            </tr>
            <tr>
              <td class='Time' id='ReliabilityTop'>
                <br><br>Loading...<br><br><br><br>
              </td>
            </tr>
            <tr>
              <td class='Time' id='ReliabilityBottom' style='border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;'>
                <br>
              </td>
            </tr>
          </table>
        </div>
        <script src='reliability.js'></script>
        <script>
          setTimeout("displayReliability()", 100);
        </script>
      </td>
      <td width="1" bgcolor="#CCCCCC">
      </td>
      <td width="1%">
      </td>
      <td width="70%">
        <table width="100%">
          <script language="javascript">
            var chromium = ""
            var webkit = "builder=Webkit%20Win%20Builder%20%28deps%29&builder=Webkit%20Win%20%28deps%29&builder=Webkit%20Win%20Builder%20%28deps%29%28dbg%29&builder=Webkit%20Win%20%28deps%29%28dbg%29%281%29&builder=Webkit%20Win%20%28deps%29%28dbg%29%282%29&builder=Webkit%20Mac%20Builder%20%28CG%29%28deps%29&builder=Webkit%20Mac10.6%20%28CG%29%28deps%29&builder=Webkit%20Mac%20Builder%20%28CG%29%28deps%29%28dbg%29&builder=Webkit%20Mac10.6%20%28CG%29%28deps%29%28dbg%29%281%29&builder=Webkit%20Mac10.6%20%28CG%29%28deps%29%28dbg%29%282%29&builder=Webkit%20Linux%20%28deps%29&builder=Webkit%20Linux%20Builder%20%28deps%29%28dbg%29&builder=Webkit%20Linux%20%28deps%29%28dbg%29%281%29&builder=Webkit%20Linux%20%28deps%29%28dbg%29%282%29"
            var memory = ""
            var perf = ""
            var chrome = ""
            var lkgr = ""
            var pyauto = ""

            var bar = "http://build.chromium.org/p/chromium/horizontal_one_box_per_builder";
            var bar_webkit = "http://build.chromium.org/p/chromium.webkit/horizontal_one_box_per_builder";
            var bar_memory = "http://build.chromium.org/p/chromium.memory/horizontal_one_box_per_builder";
            var bar_perf = "http://build.chromium.org/p/chromium.perf/horizontal_one_box_per_builder";
            var bar_chrome = "http://build.chromium.org/p/chromium.chrome/horizontal_one_box_per_builder";
            var bar_lkgr = "http://build.chromium.org/p/chromium.lkgr/horizontal_one_box_per_builder";
            var bar_pyauto = "http://build.chromium.org/p/chromium.pyauto/horizontal_one_box_per_builder";

            var waterfall = "../chromium/waterfall"
            var waterfall_webkit = "../chromium.webkit/waterfall"
            var waterfall_memory = "../chromium.memory/waterfall"
            var waterfall_chrome = "../chromium.chrome/waterfall"
            var waterfall_perf = "../chromium.perf/waterfall"
            var waterfall_lkgr = "../chromium.lkgr/waterfall"
            var waterfall_pyauto = "../chromium.pyauto/waterfall"

            function GetUrl(type, content) {
              return type + "?" + content;
            }

            function DisplayLKGR() {
              var xmlHttp = new XMLHttpRequest();
              var lkgrPath = '../chromium.lkgr/json/builders/Linux%20x64' +
                             '/builds/-1?as_text=1';
              var lkgrLink = document.getElementById('LKGRLink');
              xmlHttp.open('GET', lkgrPath, false);
              xmlHttp.send(null);
              if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                var buildData = parseJSON(xmlHttp.responseText);
                var properties = buildData['properties'];
                for (var i = 0; i < properties.length; i++) {
                  if (properties[i][0] == 'got_revision') {
                    lkgrLink.innerHTML = 'LKGR (' + properties[i][1] + ')';
                    return;
                  }
                }
              }
            }

            function DisplayBar(waterfall_url, bar_url, content, name) {
              document.write("<tr><td><a href='" + GetUrl(waterfall_url, content) + "'>" + name + "</a></td><td  colspan=7 width='99%'><iframe width='100%' height='20' frameborder='0' scrolling='no' src='" + GetUrl(bar_url, content) + "'></iframe></td></tr>\n");
            }

            DisplayBar(waterfall, bar, chromium, "Chromium");
            DisplayBar(waterfall_webkit, bar_webkit, webkit, "Webkit");
            DisplayBar(waterfall_perf, bar_perf, perf, "Perf");

            document.write("<tr>");
            document.write("<td><a href='" + GetUrl(waterfall_chrome, chrome) + "'>" + "Official"+ "</a></td><td width='13%'><iframe width='100%' height='20' frameborder='0' scrolling='no' src='" + GetUrl(bar_chrome, chrome) + "'></iframe></td>");
            document.write("<td><a href='" + GetUrl(waterfall_lkgr, lkgr) + "' id='LKGRLink'>" + "LKGR (loading)"+ "</a></td><td width='10%'><iframe width='100%' height='20' frameborder='0' scrolling='no' src='" + GetUrl(bar_lkgr, lkgr) + "'></iframe></td>");
document.write("<td><a href='" + GetUrl(waterfall_pyauto, pyauto) + "'>" + "PyAuto" + "</a></td><td width='15%'><iframe width='100%' height='20' frameborder='0' scrolling='no' src='" + GetUrl(bar_pyauto, pyauto) + "'></iframe></td>");
            document.write("<td><a href='" + GetUrl(waterfall_memory, memory) + "'>" + "Memory"+ "</a></td><td width='62%'><iframe width='100%' height='20' frameborder='0' scrolling='no' src='" + GetUrl(bar_memory, memory) + "'></iframe></td>");
            document.write("</tr>");
            setTimeout("DisplayLKGR()", 100);
          </script>
        </table>
      </td>
    </tr>
  </table>
</center>

</div>
{% endblock header %}

{% block content %}

<h1>Console View</h1>

<div align="center">
  <table width="95%" class="Grid" border="0" cellspacing="0">
    <tr>
      <td width="33%" align="left" class="left_align">
{% if categories|length > 1 %}
        <br><b>Categories:</b> {% for c in categories %}{{ c.name|e }} {% endfor %}
{% endif %}
{% if repository %}
        <br><b>Repository:</b> {{ repository|e }}
{% endif %}
{% if branch != ANYBRANCH %}
        <br><b>Branch:</b> {{ branch|e }}
{% endif %}
      </td>
      <td width="33%" align="center" class="center_align">
        <div align="center">
          <table class="info">
            <tr>
              <td>Legend:&nbsp;&nbsp;</td>
              <td class='legend success' title='All tests passed'>Passed</td>
              <td class='legend failure' title='There is a new failure. Take a look!'>Failed</td>
              <td class='legend warnings' title='It was failing before, and it is still failing. Make sure you did not introduce new regressions'>Failed&nbsp;Again</td>
              <td class='legend running' title='The tests are still running'>Running</td>
              <td class='legend exception' title='Something went wrong with the test, there is no result'>Exception</td>
              <td class='legend offline' title='The builder is offline, as there are no slaves connected to it'>Offline</td>
              <td class='legend notstarted' title='No result yet.'>No&nbsp;data</td>
            </tr>
          </table>
        </div>
      </td>
      <td width="33%" align="right" class="right_align">
      <script type="text/javascript">
// <![CDATA[
          function reload_page() {
            name_value = document.getElementById('namebox').value
            if (document.location.href.lastIndexOf('?') == -1)
              document.location.href = document.location.href+ '?name=' + name_value;
            else
              document.location.href = document.location.href+ '&name=' + name_value;
          }
// ]]>
        </script>
        <input id='namebox' name='name' type='text' style='color:#999;'
            onblur='this.value = this.value || this.defaultValue; this.style.color = "#999";'
            onfocus='this.value=""; this.style.color = "#000";'
            value='Personalized for...'/>
        <input type='submit' value='Go' onclick='reload_page()'/>
      </td>
     </tr>
  </table>
</div>

<br/>

{% set alt_class = cycler('', 'Alt') %}

<div align="center">
<table width="96%">

{% if categories|length > 1 %}
  <tr>
    <td width="1%">
    </td>
    <td width="1%">
    </td>
  {% for c in categories %}
      <td class='DevStatus {{ alt_class.next() }} {{ "first" if loop.first else '' }} {{ "last" if loop.last else '' }}' width='{{ c.size }}%'>
        {{ c.name|e }}
      </td>
  {% endfor %}
  </tr>
  <tr class='DevStatusSpacing'>
  </tr>
{% endif %}

{% if slaves %}
  <tr>
    <td width="1%">
    </td>
    <td width="1%">
    </td>
  {% for c in categories %}
    <td class='DevSlave {{ alt_class.next() }} {{ "last" if loop.last else '' }}'>
      <table width="100%">
        <tr>
    {% for s in slaves[c.name] %}
          <td class='DevSlaveBox'>
            <a href='{{ s.url }}' title='{{ s.pageTitle }}' class='DevSlaveBox {{ s.color }}' target="_blank">
            </a>
          </td>
    {% endfor %}
        </tr>
      </table>
    </td>
  {% endfor %}
  </tr>
{% endif %}

{% for r in revisions %}
  {% set alt = alt_class.next() %}
  {% set last = "last" if loop.last else "" %}

  <tr>
    <td class='DevRev {{ alt }}' width="1%">
      {{ r.id|shortrev(r.repository) }}
    </td>
    <td class='DevName {{ alt }}' width="1%">
      {{ r.who|user }}
    </td>

  {% for c in categories %}
    <td class='DevStatus {{ alt }} {{ last }}'>
      <table width="100%">
        <tr>
    {% for b in r.builds[c.name] %}
          <td class='DevStatusBox'>
            <a href='#' onclick='showBuildBox("{{ b.url }}", event); return false;'
               title='{{ b.pageTitle|e }}' class='DevStatusBox {{ b.color }} {{ b.tag }}'
               target="_blank"></a>
          </td>
    {% endfor %}
        </tr>
      </table>
    </td>
  {% endfor %}
  </tr>

  <tr>
    <td colspan="{{ r.span }}" class='DevComment {{ alt }}'>
      {{ r.comments|changecomment(r.project or None)|replace('\n', '<br/>')|replace('  ','&nbsp; ') }}
    </td>
  </tr>

  {% if r.details %}
  <tr>
    <td colspan="{{ r.span }}" class='DevDetails {{ alt }}'>
      <ul style='margin: 0px; padding: 0 0 0 1.5em;'>
    {% for d in r.details %}
        <li>{{ d.buildername }}: {{ d.status }} - &nbsp;
      {%- for l in d.logs -%}
            <a href="{{ l.url }}">{{ l.name }}</a>
      {%- endfor -%}
        </li>
    {% endfor %}
      </ul>
    </td>
  </tr>
  {% endif %}

  <tr class='DevStatusSpacing'>
    <td>
    </td>
  </tr>

{% else %}
 <tr><td>No revisions available</td></tr>
{% endfor %}

</table>
</div>


<div id="divBox" onmouseout="if (checkMouseLeave(this, event)) this.style.display = 'None'" class="BuildWaterfall">
</div>


<iframe id="frameBox" style="display: none;"></iframe>

<script type="text/javascript">
// replace 'onload="updateDiv(event);" with this, as iframe doesn't have onload event in xhtml
window.onload = function() {
  document.getElementById('frameBox').onload = function(event) {
    updateDiv(event);
  };
};
</script>

{% endblock %}


{% block footer %}

{{ super() }}
{# <p>Debug info: {{ debuginfo }}</p> #}
{% endblock %}
